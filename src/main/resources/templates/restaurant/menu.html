<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω Menu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">

<h3>üçï Menu nh√† h√†ng</h3>

<button class="btn btn-primary my-3" onclick="openModal()">+ Th√™m m√≥n</button>

<table class="table table-bordered">
    <thead class="table-success">
    <tr>
        <th>ID</th>
        <th>T√™n m√≥n</th>
        <th>Gi√°</th>
        <th>M√¥ t·∫£</th>
        <th></th>
    </tr>
    </thead>
    <tbody id="menuTable"></tbody>
</table>

<!-- Modal th√™m m√≥n -->
<div class="modal fade" id="menuModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content p-3">
            <h5>Th√™m m√≥n m·ªõi</h5>
            <input class="form-control mb-2" id="name" placeholder="T√™n m√≥n">
            <input class="form-control mb-2" id="price" placeholder="Gi√°">
            <textarea id="desc" class="form-control mb-2" placeholder="M√¥ t·∫£"></textarea>
            <button class="btn btn-success" onclick="addMenu()">Th√™m</button>
        </div>
    </div>
</div>

<script>
    let restaurantId = localStorage.getItem("restaurantId");

    function loadMenu() {
        fetch("http://localhost:8080/api/menu-items")
            .then(res => res.json())
            .then(list => {
                let table = document.getElementById("menuTable");
                table.innerHTML = "";
                list.filter(m => m.restaurant.id === restaurantId)
                    .forEach(m => {
                        table.innerHTML += `
                    <tr>
                        <td>${m.id}</td>
                        <td>${m.name}</td>
                        <td>${m.price} ‚Ç´</td>
                        <td>${m.description}</td>
                        <td>
                            <button class='btn btn-danger btn-sm' onclick="deleteMenu(${m.id})">X√≥a</button>
                        </td>
                    </tr>`;
                    });
            });
    }
    loadMenu();

    function openModal() {
        new bootstrap.Modal(document.getElementById("menuModal")).show();
    }

    function addMenu() {
        let item = {
            name: document.getElementById("name").value,
            price: document.getElementById("price").value,
            description: document.getElementById("desc").value,
            restaurantId: restaurantId
        };

        fetch("http://localhost:8080/api/menu-items", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(item)
        }).then(() => {
            alert("Th√™m m√≥n th√†nh c√¥ng!");
            loadMenu();
        });
    }

    function deleteMenu(id) {
        fetch(`http://localhost:8080/api/menu-items/${id}`, { method: "DELETE" })
            .then(() => {
                alert("ƒê√£ x√≥a m√≥n");
                loadMenu();
            });
    }
</script>

</body>
</html>

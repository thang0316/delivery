<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Dashboard | Restaurant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background: #eef2f5; font-family: "Segoe UI"; }

        .sidebar {
            position: fixed;
            top: 0; left: 0;
            width: 220px; height: 100vh;
            background: #198754;
            padding-top: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.15);
        }
        .sidebar a {
            color: white; text-decoration:none;
            padding: 14px 20px; display:block;
            font-weight: 500;
        }
        .sidebar a:hover { background: rgba(255,255,255,0.18); }

        .content { margin-left: 240px; padding: 25px; }
        .card-box { padding:25px; border-radius:12px; background:white; box-shadow:0 3px 10px rgba(0,0,0,0.08); }
    </style>
</head>
<body>

<div class="sidebar">
    <a href="/restaurant/dashboard">ğŸ  Dashboard</a>
    <a href="/restaurant/menu">ğŸ• Menu</a>
    <a href="/restaurant/orders">ğŸ“¦ ÄÆ¡n hÃ ng</a>
    <a href="/restaurant/drones">ğŸ›© Drone</a>
    <a href="/restaurant/payments">ğŸ’³ Thanh toÃ¡n</a>
    <a href="/restaurant/profile">ğŸ‘¤ Há»“ sÆ¡</a>
</div>

<div class="content">
    <h2>ğŸ  Dashboard NhÃ  hÃ ng</h2>

    <div class="row mt-4">
        <div class="col-4"><div class="card-box">
            <h5>ğŸ“¦ Tá»•ng Ä‘Æ¡n</h5>
            <h2 id="orderCount">0</h2>
        </div></div>

        <div class="col-4"><div class="card-box">
            <h5>ğŸ›© Drone hoáº¡t Ä‘á»™ng</h5>
            <h2 id="droneActive">0</h2>
        </div></div>

        <div class="col-4"><div class="card-box">
            <h5>ğŸ’° Doanh thu</h5>
            <h2 id="revenue">0 â‚«</h2>
        </div></div>
    </div>
</div>

<script>
    const restaurantId = localStorage.getItem("restaurantId");

    /* ================================
           1) Tá»•ng Ä‘Æ¡n hÃ ng
    ================================= */
    fetch(`/api/orders`)
        .then(r => r.json())
        .then(list => {
            const myOrders = list.filter(o => o.restaurant.id === restaurantId);
            orderCount.innerText = myOrders.length;
        });

    /* ================================
           2) Drone hoáº¡t Ä‘á»™ng
    ================================= */
    fetch(`/api/drones/restaurant/${restaurantId}`)
        .then(r => r.json())
        .then(list => {
            droneActive.innerText = list.filter(x => x.status === "AVAILABLE").length;
        });

    /* ================================
           3) Doanh thu = Tá»•ng totalAmount
    ================================= */
    fetch(`/api/orders`)
        .then(r => r.json())
        .then(list => {
            const myOrders = list.filter(o => o.restaurant.id === restaurantId);

            let totalRevenue = myOrders.reduce((sum, o) => sum + o.totalAmount, 0);

            revenue.innerText = totalRevenue.toLocaleString("vi-VN") + " â‚«";
        });
</script>

</body>
</html>
